---
layout:     post
title:      家庭网络
subtitle:   The Home network
date:       2025-01-22
author:     shake
header-img: img/post-bg-2015.jpg
catalog: true
tags:
    - 技术
---

家里的网络很简单，路由器只是负责拨号上网，梯子，基本都是通过设备本身来完成。那么这次在家里长时间，已经感觉很不方便，就投入时间来彻底解决问题。

其实R2S的软路由，在他刚刚发布开发板的时候，我就采购，但是一直懒惰，没有用起来。这次就真的要花时间解决过去几年的各种问题。

需要解决的问题

* 海外访问家里网络，打开各种ip检查的app的限制。这样对得起家里一年1k的宽带费用
* 全家设备，无感访问网络。以前我只需要解决我自己的需求，现在需要考虑家人的应用，例如line。
* 技术上要有点追求，解决各种安全的隐患，例如dns泄漏等。

## 海外服务器

其实现在海外服务器，价格真的已经很便宜。我使用racknerd 服务器，11美金。现在100人民币一年的vps，选择很多。现在使用的vps，不提供IPv6的地址。

如果你的服务器提供ipv6的地址，那么理论上，你就拥有无限的ipv6地址。通过ipv6访问，是很难拦截你的。

选择vps，要支持ipv6，是一个首选。

这次测试，发现一台vps，1core，1G内存，真的是严重性能浪费。我在digitalocean，启动最低配置的机器，512m内存，跑起来一点都没问题，并且我是在一台vps，跑多个协议，完全没问题，甚至装上3x-ui，性能都是完全够用。

vps端，无论采用web ui（3x-ui）配置，还是自己在服务器上配置，都很简单。

3x-ui，是xray的内核，基本上市场上你看到的各种玩法，都可以在上面实现。并且官方提供的安装脚本，都写出花，啥功能都有。直接给你域名搞出证书，让你第一次访问 UI，就可以实现https。真的不容易，做到这点，真的大大提高安全性。我也是看了 3x-ui 的脚本这个功能，信任它。

目前市场的翻墙新秀是：sing-box。和xray一样，不过目前服务器端端web管理端，还是比较欠缺，s-ui，还是很弱，所以sing-box的各种协议，还是需要自己手搓。不过理解了，其实都简单。

Hysteria, 这是一个协议，做梯子的效果，还是非常好的。尤其线路质量不好的地方。我一直在使用。Hysteria，xray官方表示，不考虑支持，sing-box是支持。

Hysteria，vps上，我就直接部署，没有基于sing-box。这样更加简单。

所以我的vps上，可以理解跑着2套环境，3x-ui和Hysteria。基本基本支持市场上的所有的各种玩法。也仅仅是为了了解和学习。

我的racknerd的vps，价格原因，是不支持ipv6，但是现在你是可以通过ipv6 隧道的方式，获得ipv6的地址。这样的玩法，其实真的突破我的认知，没想到2015年，就有人这样玩。**IPv6 Tunnel Broker** , 到 https://tunnelbroker.net/ 注册一个账号，简单配置一下，就可以玩起来。

vps支持ipv6，并且ipv6到ip，可不是1个，可以理解成无限，先给vps，搞10个来玩玩。日后连接服务器，就直接用ipv6地址就可以。

目前我的域名注册商，还不支持ipv6解析，真的需要考虑，迁移到CF，解决这个问题。

所以目前VPS端端方案，就比较成熟

* ipv6+ipv4
* 3x-ui，xray各种玩法，重点是Reality。也通过cdn，加上xhttp+cdn上行，reality+下行。
* Hysteria2，直接使用官方脚本搭建，支持ipv6，ipv6优先。

可以说，目前这是一个vps 最优解。

其实我也尝试过在vps上装一个sing-box，一个配置文件，支持3种协议，包括Hysteria2。也是没问题。充分发挥vps的潜力。

## OpenWrt

现在的Openwrt和我20年前接触的，已经完全不一样。各种的玩法，眼花缭乱。真的有那么多需求，还是在哪里瞎折腾。

ImmortalWrt, 你基本可以理解，就是OpenWRT的翻版，默认很简洁，和官方一样，就是多一个repo，里面有你所有需要，不需要梯子就可以访问，并且很贴心，提供定制固件。

目前OpenWRT上，有3个解决方案

* passwall （支持xray，sing-box）
* openclash
* homeproxy （只支持sing-box）

我没精力和需求，折腾各种工具，就选择了homeproxy。也确实简单。非常简单，配置就可以搞定上网。专门配置，支持ipv6，这样才能发挥ipv6的优势。

真正挑战的是，解决所谓的DNS泄漏问题。进行测试的时候，肯定能看到国内的dns服务器，很恶心。研究了很久，最后也是用了最优雅的方式，把dns的解析，交给mosdns插件来解决。

非常完美解决的dns泄漏，同时也利用缓存，加快访问速度。

OpenWRT的homeproxy，是使用sing-box，作为客户端来连接到服务器端。解决家庭网络的访问的问题。还同时提供一个server端，让你可以利用公网的ip地址，搭建一个国内的服务器，让海外可以翻回国内。

这个配置起来很简单，海外回国，应该简单很多。

## wireguard

大名鼎鼎的vpn软件，其实完也是第一次玩，装openwrt装上，你就可以很简单的方式，访问家里的网络，访问openwrt的管理界面。加上一个ddns，充分把ipv6用起来。感觉很完美。

东南亚的国家，其实都启用了ipv6，很方便通过ipv6连接到国内的家里路由器。openwrt上的wiregrad，使用很简单，各种客户端，你就只需要扫描一个二维码，一切都搞定。

如果国内出门，可以通过wireguard连接家里网络，一切就和你在家里上一样的。海外连接，就慢一点。比在手机上装一个sing-box，好像简单很多。

sing-box能很好支持安卓，apple，免费，也是一个很好的备胎。

sing-box的1.11版本，支持wireguard，应该可以简单很多。

![wrt](/img/2025/jan/wrt.png "wrt")

